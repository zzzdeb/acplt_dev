
/******************************************************************************
 *
 *   FILE
 *   ----
 *   dsyncTest.c
 *
 *   History
 *   -------
 *   2018-11-19   File created
 *
 *******************************************************************************
 *
 *   This file is generated by the 'acplt_builder' command
 *
 ******************************************************************************/

#ifndef OV_COMPILE_LIBRARY_syncTest
#define OV_COMPILE_LIBRARY_syncTest
#endif

#include "libov/ov_macros.h"
#include "sync.h"
#include "syncTest.h"

#include "unity.h"
#include "unity_fixture.h"

#include "ovunity.h"
#include "ovunity_helper.h"

#include "CException.h"

OV_INSTPTR_ovunity_main gpinst;

OV_TIME* gpltc;

TEST_GROUP(dsync);

TEST_SETUP(dsync) { ov_memstack_lock(); }

TEST_TEAR_DOWN(dsync) { ov_memstack_unlock(); }

TEST(dsync, dsync_default) {
  OV_RESULT             result = OV_ERR_OK;
  OV_INSTPTR_sync_dsync pobj = NULL;
  OV_STRING             case_name = "case_self2dsync";
  OV_STRING             case_path = ovunity_getCasePath(gpinst, case_name);

  /* create case */
  OV_INSTPTR_ovunity_ovCase pcase = ovunity_createCase(gpinst, case_name);
  if(!pcase)
    Throw(OV_ERR_GENERIC);

  ovunity_ovCase_build1(pcase);
  pobj = Ov_StaticPtrCast(sync_dsync, ovunity_ovCase_getObjPath(pcase));

  pobj->v_actimode = 1;
  /* sync_dsync_typemethod(pobj, gpltc); */

  result = ovunity_compareIstSoll(pcase);

  TEST_ASSERT_EQUAL(result, 0);
}

TEST_GROUP_RUNNER(dsync) { RUN_TEST_CASE(dsync, dsync_default); }

static void RunAllTests(void) { RUN_TEST_GROUP(dsync); }

OV_DLLFNCEXPORT void
syncTest_dsyncTest_typemethod(OV_INSTPTR_fb_functionblock pfb, OV_TIME* pltc) {
  /*
   *   local variables
   */
  OV_INSTPTR_syncTest_dsyncTest pinst =
      Ov_StaticPtrCast(syncTest_dsyncTest, pfb);
  gpinst = Ov_StaticPtrCast(ovunity_main, pfb);
  //	gpobj = &Ov_StaticPtrCast(syncTest_dsyncTest,gpinst)->p_obj;
  gpltc = pltc;

  // todo
  char* ahome = getenv("ACPLT_HOME");
  ov_string_print(&pinst->v_sysPath, "%s/dev/syncTest/test/dsyncTest", ahome);

  const char*  argv[] = {"dsync", "-v"};
  CEXCEPTION_T e;
  Try { UnityMain(2, argv, RunAllTests); }
  Catch(e) { ov_logfile_error("dsyncTest fail"); }
  return;
}

